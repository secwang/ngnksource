<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>w/x/tetris.k - ngnksource</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

.nav-bar {
    font-size: 120%;
    margin-top: 5px;
    margin-bottom: 5px;
}

.nav-link {
    padding-left: 5em;
    padding-right: 5em;
}

ul.toc {
    line-height: 200%;
    font-size: 150%;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

  <h1>w/x/tetris.k - ngnksource</h1>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L23">c</a></li>
<li><a href="#L13">d</a></li>
<li><a href="#L26">draw</a></li>
<li><a href="#L11">f</a></li>
<li><a href="#L10">i</a></li>
<li><a href="#L35">kd</a></li>
<li><a href="#L24">q</a></li>
<li><a href="#L25">w</a></li>
</ul>
 <h2>Source code</h2>

  <code><ol><li>A:(<span class="Constant">&quot;####|##|###|## |###| ##|###&quot;<br/></li>
<li></span>&nbsp;&nbsp; <span class="Constant">&quot;&nbsp; &nbsp; |##| # | ##|#&nbsp; |## |&nbsp; #&quot;</span>)<br/></li>
<li>T:&amp;''<span class="Constant">3</span>(|+:)\'(|/')#'+<span class="Constant">&quot;#&quot;</span>=<span class="Constant">&quot;|&quot;</span>\'A /tetrominos by type <span class="Statement">and</span> rotation<br/></li>
<li>C:`cyan`yellow`magenta`green`blue`red`orange /colours by piece type<br/></li>
<li><span class="cBitField">a:</span><span class="Constant">20</span> <span class="Constant">10</span>#<span class="Constant">0</span> /grid (boolean matrix without the falling piece)<br/></li>
<li>g:0N?#T /randomized bag of <span class="Constant">0</span>..<span class="Constant">6<br/></li>
<li></span>s:<span class="Constant">0</span> /score<br/></li>
<li><br/></li>
<li>/falling piece (p:position,<a href="../../dy/a.k.html#L110" title="dy/a.k:110">t</a>:type,<a href="../../l/fmt.k.html#L39" title="l/fmt.k:39">r</a>:rotation)<br/></li>
<li><a id="L10">&#x200c;</a><span class="linkable">i</span>:{$[<a href="../../l/fmt.k.html#L47" title="l/fmt.k:47">f</a>[<span class="Constant">3</span> <span class="Constant">0</span>;*g;<span class="Constant">3</span>];;tick::(::)];g::<span class="Constant">1_g</span>;$[g;;g::0N?#T];<span class="Constant">0</span>} /<a href="../../l/fmt.k.html#L8" title="l/fmt.k:8">init</a> piece<br/></li>
<li><a id="L11">&#x200c;</a><span class="linkable">f</span>:{$[<span class="Error">*/</span>~a ./:+|x+T[y]z&nbsp;&nbsp; /<span class="Statement">try</span> to set position,type,rotation<br/></li>
<li> [<span class="Statement">p:</span>:x;<a href="../../dy/a.k.html#L110" title="dy/a.k:110">t</a>::y;<a href="../../l/fmt.k.html#L39" title="l/fmt.k:39">r</a>::z;<span class="Constant">1</span>];<span class="Constant">0</span>]}&nbsp; /<span class="Statement">return</span> <span class="Constant">1</span> <span class="Statement">for</span> success, <span class="Constant">0</span> <span class="Statement">for</span> collision<br/></li>
<li><a id="L13">&#x200c;</a><span class="Statement"><span class="linkable">d</span></span><span class="cUserCont">:</span>{$[<a href="../../l/fmt.k.html#L47" title="l/fmt.k:47">f</a>[p+<span class="Constant">0</span> <span class="Constant">1</span>;<a href="../../dy/a.k.html#L110" title="dy/a.k:110">t</a>;<a href="../../l/fmt.k.html#L39" title="l/fmt.k:39">r</a>];:<span class="Constant">1</span>;]&nbsp;&nbsp; /<span class="Statement">try</span> to move it down. <span class="Statement">if</span> successful, <span class="Statement">return</span> <span class="Constant">1<br/></li>
<li></span> a::a .[;;:;<span class="Constant">1</span>]/+|p+T[<a href="../../dy/a.k.html#L110" title="dy/a.k:110">t</a>]<a href="../../l/fmt.k.html#L39" title="l/fmt.k:39">r</a> /freeze fallen blocks<br/></li>
<li><span class="cUserCont"> </span><span class="Statement">n</span><span class="cUserCont">:</span>+/<a href="../../l/fmt.k.html#L41" title="l/fmt.k:41">m</a>:<span class="Error">*/</span>'a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /number of <span class="Statement">and</span> mask of completed lines<br/></li>
<li> a::(<span class="Constant">0</span>*n#a),a@&amp;~<a href="../../l/fmt.k.html#L41" title="l/fmt.k:41">m</a>&nbsp; &nbsp; &nbsp; &nbsp; /clear completed lines, replenish <span class="Statement">with</span> empty<br/></li>
<li> s+:-<span class="Constant">1</span>+<span class="Error">*/</span>n#<span class="Constant">2</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /update score<br/></li>
<li> <a href="#L10" title="w/x/tetris.k:10">i</a>[]}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /respawn<br/></li>
<li><span class="Statement">tick</span><span class="cUserCont">:</span><a href="#L13" title="w/x/tetris.k:13">d</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /periodically call <a href="#L13" title="w/x/tetris.k:13">d</a>[]<br/></li>
<li><br/></li>
<li>/rendering<br/></li>
<li><span class="Statement">b</span><span class="cUserCont">:</span><span class="Constant">0.9</span>*B:<span class="Constant">1</span>%#a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /block size<br/></li>
<li><a id="L23">&#x200c;</a><span class="Statement"><span class="linkable">c</span></span><span class="cUserCont">:</span>{<span class="Constant">&quot;g.fillStyle='&quot;</span>,($x),<span class="Constant">&quot;';&quot;</span>}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /set colour<br/></li>
<li><a id="L24">&#x200c;</a><span class="Statement"><span class="linkable">q</span></span><span class="cUserCont">:</span>{<span class="Constant">&quot;g.fillRect(&quot;</span>,(<span class="Constant">&quot;,&quot;</span>/$(B*x),<span class="Constant">2</span>#b),<span class="Constant">&quot;);&quot;</span>}&nbsp; /<a href="#L26" title="w/x/tetris.k:26">draw</a> a square(block)<br/></li>
<li><a id="L25">&#x200c;</a><span class="Statement"><span class="linkable">w</span></span><span class="cUserCont">:</span>{<span class="Constant">&quot;g.fillText(&quot;</span>,(<span class="Constant">&quot;,&quot;</span>/(,`<a href="../../l/runparts.k.html#L3" title="l/runparts.k:3">k</a>[x]),$y),<span class="Constant">&quot;);&quot;</span>} /write text<br/></li>
<li><a id="L26">&#x200c;</a><span class="Statement"><span class="linkable">draw</span></span><span class="cUserCont">:</span>{`js@,<span class="Comment">//(&quot;g.clearRect(0,0,1,1);&quot;<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L23" title="w/x/tetris.k:23">c</a>`<span class="Constant">&quot;#80808020&quot;</span>;<a href="#L24" title="w/x/tetris.k:24">q</a>'+|&amp;<span class="Constant">1</span>|a&nbsp; &nbsp;&nbsp; /semi-transparent grid background<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L23" title="w/x/tetris.k:23">c</a> C <a href="../../dy/a.k.html#L110" title="dy/a.k:110">t</a>;<a href="#L24" title="w/x/tetris.k:24">q</a>'+p+T[<a href="../../dy/a.k.html#L110" title="dy/a.k:110">t</a>]<a href="../../l/fmt.k.html#L39" title="l/fmt.k:39">r</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /<a href="#L26" title="w/x/tetris.k:26">draw</a> falling piece<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L23" title="w/x/tetris.k:23">c</a>`white;<a href="#L24" title="w/x/tetris.k:24">q</a>'+|&amp;a&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; /<a href="#L26" title="w/x/tetris.k:26">draw</a> stationary blocks<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L25" title="w/x/tetris.k:25">w</a>[<span class="Constant">&quot;score:&quot;</span>,$s;<span class="Constant">1</span>%<span class="Constant">2</span> <span class="Constant">16</span>]&nbsp; &nbsp; &nbsp; /<a href="#L26" title="w/x/tetris.k:26">draw</a> score<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $[tick;<a href="#L23" title="w/x/tetris.k:23">c</a> C@*g;<a href="#L24" title="w/x/tetris.k:24">q</a>'+(<span class="Constant">2</span>+#*a;<span class="Constant">4</span>)+T[*g]<span class="Constant">3</span> /shadow piece..<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <a href="#L25" title="w/x/tetris.k:25">w</a>[<span class="Constant">&quot;game over&quot;</span>;<span class="Constant">1</span>%<span class="Constant">2</span> <span class="Constant">2</span>]]<span class="Error">)</span>}&nbsp; &nbsp; /..<span class="Statement">or</span> <span class="Constant">&quot;game over&quot;<br/></li>
<li></span><br/></li>
<li>/key down event handler<br/></li>
<li><a id="L35">&#x200c;</a><span class="Statement"><span class="linkable">kd</span></span><span class="cUserCont">:</span>{$[<span class="Constant">32</span>=x;(::)<a href="#L13" title="w/x/tetris.k:13">d</a>/<span class="Constant">1</span>&nbsp; &nbsp; &nbsp; /space(drop)<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">37</span>=x;<a href="../../l/fmt.k.html#L47" title="l/fmt.k:47">f</a>[p-<span class="Constant">1</span> <span class="Constant">0</span>;<a href="../../dy/a.k.html#L110" title="dy/a.k:110">t</a>;<a href="../../l/fmt.k.html#L39" title="l/fmt.k:39">r</a>] /left<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">38</span>=x;<a href="../../l/fmt.k.html#L47" title="l/fmt.k:47">f</a>[p;<a href="../../dy/a.k.html#L110" title="dy/a.k:110">t</a>;<span class="Constant">4</span>!<span class="Constant">1</span>+<a href="../../l/fmt.k.html#L39" title="l/fmt.k:39">r</a>] /up(rotate)<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">39</span>=x;<a href="../../l/fmt.k.html#L47" title="l/fmt.k:47">f</a>[p+<span class="Constant">1</span> <span class="Constant">0</span>;<a href="../../dy/a.k.html#L110" title="dy/a.k:110">t</a>;<a href="../../l/fmt.k.html#L39" title="l/fmt.k:39">r</a>] /right<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">40</span>=x;<a href="#L13" title="w/x/tetris.k:13">d</a>[]]}&nbsp; &nbsp; &nbsp; &nbsp; /down<br/></li>
<li><br/></li>
<li><a href="#L10" title="w/x/tetris.k:10">i</a>[];<br/></li>
<li>`js<span class="Constant">&quot;tickPeriod=500&quot;</span>;&nbsp; &nbsp;&nbsp; /tick[] will be called every half second<br/></li>
<li>`js<span class="Constant">&quot;hgr()&quot;</span>;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /enter graphics mode<br/></li>
<li><br/></li>
<li>/<span class="Statement">for</span> a similar language <span class="Statement">with</span> more advanced graphics capabilities see:<br/></li>
<li>/ https:<span class="Comment">//johnearnest.github.io/ok/ike/ike.html<br/></li>
</ol></span></code>
 <p class="nav-bar">
  <span class="nav-link"><a href="./index.html">One Level Up</a></span>
  <span class="nav-link"><a href="../../index.html">Top Level</a></span>
 </p>

 </body>
</html>
